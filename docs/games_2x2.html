<html>
	<head>
		<title>Diagrams showing 2x2 games</title>
		<meta charset="utf-8">
<style>
table {
	border: solid black 1px;
}
td {
	border: solid black 1px;
}
input {
	width: 60px;
}
svg {
	width: 500px;
	height: 500px;
}
line {
	stroke-width: 1px;
	stroke: black;
}
polygon.bg {
	fill: #ccc;
}
polygon.fill {
	fill: rgba(0,255,0,0.5);
}
</style>
<script>

function same_point(a,b)
{
	return a[0] === b[0] && a[1] === b[1];
}

function remove_duplicate_points(points)
{
	var result = [];
	for (var i = 0; i < points.length; i++)
	{
		var found = false;
		for (var j = 0; j < result.length; j++)
		{
			if (same_point(result[j], points[i]))
			{
				found = true;
			}
		}
		if (!found)
		{
			result.append(points[i]);
		}
	}
	return result;
}

function read_number(player0_move, player1_move, utility_player)
{
	var moves0 = ['a','b'];
	var moves1 = ['a','b'];
	var players = ['1','2'];
	var name = moves0[player0_move] + moves1[player1_move] + players[utility_player];
	return parseInt(document.getElementById(name).value);
}

function clear_inputs()
{
	document.getElementById('aa1').value = '';
	document.getElementById('ab1').value = '';
}

function corners()
{
	var result = [];
	for (var p0 = 0; p0 < 2; p0++)
	{
		for (var p1 = 0; p1 < 2; p1++)
		{
			result.push( [read_number(p0,p1,0), read_number(p0,p1,1) ] );
		}
	}
	return result;
}

function clear_diagram()
{
	var svg = document.getElementById('diagram');
	while (svg.firstChild) {
		svg.removeChild(svg.firstChild);
	}
}

function x_coord(x)
{
	return 50 + 50 * x;
}

function y_coord(y)
{
	return 450 - 50 * y;
}

function circle(x, y, r)
{
	var circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
	circle.setAttribute('cx', x_coord(x));
	circle.setAttribute('cy', y_coord(y));
	circle.setAttribute('r', r);
	return circle;
}

function line(x1, y1, x2, y2)
{
	var line = document.createElementNS('http://www.w3.org/2000/svg','line');
	line.setAttribute('x1', x_coord(x1));
	line.setAttribute('y1', y_coord(y1));
	line.setAttribute('x2', x_coord(x2));
	line.setAttribute('y2', y_coord(y2));
	return line;
}

function polygon(coords, clazz)
{
	var str = '';
	for (var i = 0; i < coords.length; i++)
	{
		str += x_coord(coords[i][0]) + ',' + y_coord(coords[i][1]) + ' ';
	}
	var polygon = document.createElementNS('http://www.w3.org/2000/svg','polygon');
	polygon.setAttribute('points', str);
	polygon.setAttribute('class', clazz);
	return polygon;
}

function label(x,y)
{
	var text_content = '{' + x + ',' + y + '}';
	var text = document.createElementNS('http://www.w3.org/2000/svg','text');
	text.textContent = text_content;
	text.setAttribute('x', x_coord(x))
	text.setAttribute('y', y_coord(y) - 20)
	text.setAttribute('width', 100);
	text.setAttribute('height', 100);
	return text;
}

function sweeper(svg)
{
	var self = {
		_last: undefined,

		add: function(x0, y0, x1, y1)
		{
			var last = self._last;
			if (last !== undefined)
			{
				svg.append(polygon([
					[x0,y0],
					[x1,y1],
					[last.x1,last.y1],
					[last.x0,last.y0]
				], 'fill'));
			}
			svg.append(line(x0,y0,x1,y1));

			self._last = {x0:x0,y0:y0,x1:x1,y1:y1};
		}
	};
	return self;
}

function take_point(points, point)
{
	for (var i = 0; i < points.length; i++)
	{
		if (points[i][0] == point[0] && points[i][1] == point[1])
		{
			points.splice(i,i);
			take_point(points, point);
			return point;
		}
	}
	return undefined;
}

function take_leftmost(points)
{
	var leftmost = points[0];
	for (var i = 1; i < points.length; i++)
	{
		if (points[i][0] < leftmost[0]);
		{
			leftmost = points[i];
		}
	}
	return take_point(points, leftmost);
}

function giftwrap(points)
{
	var polygon = [take_leftmost(points)];
	var angle = 0;

	var point;


	return polygon;
}

function draw_diagram()
{
	clear_diagram();
	var c = corners();

	var svg = document.getElementById('diagram');

	svg.append(polygon(c,'bg'));

	for (var i = 0; i < 4; i++)
	{
		var x = c[i][0];
		var y = c[i][1];
		svg.append(circle(x,y,5));

		svg.append(label(x,y));
	}

	var x1 = c[0][0];
	var y1 = c[0][1];
	var x2 = c[1][0];
	var y2 = c[1][1];
	var x3 = c[2][0];
	var y3 = c[2][1];
	var x4 = c[3][0];
	var y4 = c[3][1];

	var sw0 = sweeper(svg);
	var sw1 = sweeper(svg);

	for (var i = 0; i <= 16; i++)
	{
		var j = i / 16.0;
		var k = 1 - j;

		sw0.add(x1 * j + x3 * k, y1 * j + y3 * k, 
			x2 * j + x4 * k, y2 * j + y4 * k);
		sw1.add(x1 * j + x2 * k, y1 * j + y2 * k,
			x3 * j + x4 * k, y3 * j + y4 * k);
	}
}

</script>
<script src="app.bundle.js"></script>
	</head>
	<body>
		<table>
			<tr>
				<th></th>
				<th>Player 2: A</th>
				<th>Player 2: B</th>
			</tr>
			<tr>
				<th>Player 1: A</th>
				<td>
					<input type="text" id="aa1">
					<input type="text" id="aa2">
				</td>
				<td>
					<input type="text" id="ab1">
					<input type="text" id="ab2">
				</td>
			</tr>
			<tr>
				<th>Player 1: B</th>
				<td>
					<input type="text" id="ba1">
					<input type="text" id="ba2">
				</td>
				<td>
					<input type="text" id="bb1">
					<input type="text" id="bb2">
				</td>
			</tr>
		</table>
		<input type="button" onclick="draw_diagram()" value="Generate">
		<input type="button" onclick="clear_inputs()" value="Clear"><br>
		<svg id="diagram">
		</svg>
	</body>
</html>
